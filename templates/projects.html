{% extends "base.html" %}

{% block title %}Projects - Python Developer Portfolio{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>My Projects</h1>
        <p>{{ projects|length }} projects | Python development portfolio</p>
    </div>
</section>

<section class="projects-section">
    <div class="container">
        <!-- Filters -->
        <div class="filters terminal-command-line">
            <span class="terminal-prompt">$ grep --category=</span>
            <div class="filter-group">
                <select id="categoryFilter" class="filter-select" aria-label="Filter projects by category" title="Filter projects by category">
                    <option value="">*</option>
                    <option value="Machine Learning">ml/</option>
                    <option value="Web Development">web/</option>
                    <option value="Data Science">data/</option>
                    <option value="DevOps">devops/</option>
                </select>
            </div>
            
            <span class="terminal-prompt">--tech=</span>
            <div class="filter-group">
                <select id="technologyFilter" class="filter-select" aria-label="Filter projects by technology" title="Filter projects by technology">
                    <option value="">*</option>
                    <option value="Python">python</option>
                    <option value="Django">django</option>
                    <option value="Flask">flask</option>
                    <option value="FastAPI">fastapi</option>
                    <option value="TensorFlow">tensorflow</option>
                    <option value="Docker">docker</option>
                    <option value="PostgreSQL">postgresql</option>
                </select>
            </div>
            
            <button id="resetFilters" class="btn btn-secondary btn-small">$ reset</button>
        </div>

        <!-- Projects Grid -->
        <div class="projects-grid" id="projectsGrid">
            {% for project in projects %}
            <div class="project-card terminal-window" data-category="{{ project.category }}" data-technologies="{{ project.technologies|join(',') }}">
                <div class="terminal-header">
                    <div class="terminal-dots">
                        <span class="terminal-dot"></span>
                        <span class="terminal-dot"></span>
                        <span class="terminal-dot"></span>
                    </div>
                    <span>drwxr-xr-x {{ project.title|lower|replace(' ', '-') }}/</span>
                </div>
                <div class="project-image">
                    <img src="{{ project.image }}" alt="{{ project.title }}" onerror="this.src='/static/images/placeholder.jpg'">
                    <div class="project-overlay">
                        <a href="{{ url_for('project_detail', project_id=project.id) }}" class="btn btn-small">$ cd details/</a>
                    </div>
                </div>
                <div class="project-content">
                    <span class="project-category">[{{ project.category|upper }}]</span>
                    <h3>{{ project.title }}</h3>
                    <p>{{ project.description }}</p>
                    <div class="project-tech">
                        {% for tech in project.technologies %}
                        <span class="tech-badge">[{{ tech }}]</span>
                        {% endfor %}
                    </div>
                    <div class="project-links">
                        {% if project.github %}
                        <a href="{{ project.github }}" target="_blank" rel="noopener noreferrer" class="project-link">
                            [GIT] source
                        </a>
                        {% endif %}
                        {% if project.demo %}
                        <a href="{{ project.demo }}" target="_blank" rel="noopener noreferrer" class="project-link">
                            [WWW] demo
                        </a>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div id="noResults" class="no-results" style="display: none;">
            <p class="terminal-output">$ find . -name "*" | wc -l</p>
            <p class="terminal-output">0</p>
            <p>No projects found matching your filters.</p>
        </div>
    </div>
</section>

<!-- Code Example Section -->
<section class="code-example-section">
    <div class="container">
        <h2 class="section-title">┌─[ CODE_QUALITY ]─┐</h2>
        <p class="section-subtitle terminal-output">$ cat best-practices.txt | grep -i "clean code"</p>
        
        <div class="code-examples">
            <div class="code-example terminal-window">
                <div class="terminal-header">
                    <div class="terminal-dots">
                        <span class="terminal-dot"></span>
                        <span class="terminal-dot"></span>
                        <span class="terminal-dot"></span>
                    </div>
                    <span>repository_pattern.py</span>
                </div>
                <div class="terminal-body">
                    <h3>Clean Architecture Example</h3>
                    <pre><code class="language-python"># Example: Repository Pattern Implementation
from abc import ABC, abstractmethod
from typing import List, Optional

class UserRepository(ABC):
    """Abstract base class for user data access"""
    
    @abstractmethod
    async def get_by_id(self, user_id: int) -> Optional[User]:
        """Retrieve user by ID"""
        pass
    
    @abstractmethod
    async def create(self, user: User) -> User:
        """Create new user"""
        pass
    
    @abstractmethod
    async def update(self, user: User) -> User:
        """Update existing user"""
        pass

class PostgresUserRepository(UserRepository):
    """PostgreSQL implementation of UserRepository"""
    
    def __init__(self, db_session):
        self.db = db_session
    
    async def get_by_id(self, user_id: int) -> Optional[User]:
        query = "SELECT * FROM users WHERE id = $1"
        result = await self.db.fetch_one(query, user_id)
        return User(**result) if result else None
    
    async def create(self, user: User) -> User:
        query = """
            INSERT INTO users (name, email, created_at)
            VALUES ($1, $2, $3)
            RETURNING *
        """
        result = await self.db.fetch_one(
            query, user.name, user.email, user.created_at
        )
        return User(**result)
</code></pre>
                </div>
            </div>
            
            <div class="code-example terminal-window">
                <div class="terminal-header">
                    <div class="terminal-dots">
                        <span class="terminal-dot"></span>
                        <span class="terminal-dot"></span>
                        <span class="terminal-dot"></span>
                    </div>
                    <span>test_user_service.py</span>
                </div>
                <div class="terminal-body">
                    <h3>Testing Example</h3>
                    <pre><code class="language-python"># Example: Comprehensive Unit Testing
import pytest
from unittest.mock import Mock, AsyncMock
from app.services import UserService
from app.models import User

@pytest.fixture
def mock_repository():
    """Fixture for mocked repository"""
    return Mock()

@pytest.fixture
def user_service(mock_repository):
    """Fixture for user service with mocked dependencies"""
    return UserService(repository=mock_repository)

@pytest.mark.asyncio
async def test_create_user_success(user_service, mock_repository):
    """Test successful user creation"""
    # Arrange
    user_data = {"name": "John Doe", "email": "john@example.com"}
    expected_user = User(id=1, **user_data)
    mock_repository.create = AsyncMock(return_value=expected_user)
    
    # Act
    result = await user_service.create_user(user_data)
    
    # Assert
    assert result.id == 1
    assert result.name == "John Doe"
    mock_repository.create.assert_called_once()

@pytest.mark.asyncio
async def test_create_user_duplicate_email(user_service, mock_repository):
    """Test user creation with duplicate email"""
    # Arrange
    user_data = {"name": "John Doe", "email": "existing@example.com"}
    mock_repository.create = AsyncMock(
        side_effect=DuplicateEmailError()
    )
    
    # Act & Assert
    with pytest.raises(DuplicateEmailError):
        await user_service.create_user(user_data)
</code></pre>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
// Project filtering functionality
document.addEventListener('DOMContentLoaded', function() {
    const categoryFilter = document.getElementById('categoryFilter');
    const technologyFilter = document.getElementById('technologyFilter');
    const resetButton = document.getElementById('resetFilters');
    const projectsGrid = document.getElementById('projectsGrid');
    const noResults = document.getElementById('noResults');
    
    function filterProjects() {
        const selectedCategory = categoryFilter.value;
        const selectedTechnology = technologyFilter.value;
        const projects = projectsGrid.querySelectorAll('.project-card');
        let visibleCount = 0;
        
        projects.forEach(project => {
            const projectCategory = project.dataset.category;
            const projectTechnologies = project.dataset.technologies;
            
            const categoryMatch = !selectedCategory || projectCategory === selectedCategory;
            const technologyMatch = !selectedTechnology || projectTechnologies.includes(selectedTechnology);
            
            if (categoryMatch && technologyMatch) {
                project.style.display = 'block';
                visibleCount++;
            } else {
                project.style.display = 'none';
            }
        });
        
        noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    }
    
    categoryFilter.addEventListener('change', filterProjects);
    technologyFilter.addEventListener('change', filterProjects);
    
    resetButton.addEventListener('click', function() {
        categoryFilter.value = '';
        technologyFilter.value = '';
        filterProjects();
    });
});
</script>
{% endblock %}
