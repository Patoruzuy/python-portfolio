{% extends "base.html" %}

{% block title %}Blog - Python Developer Portfolio{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>Technical Blog</h1>
        <p>Insights, tutorials, and thought leadership on Python development and software engineering</p>
    </div>
</section>

<section class="blog-section">
    <div class="container">
        <div class="blog-layout">
            <!-- Main Content -->
            <div class="blog-main">
                <div class="blog-filters">
                    <button class="filter-btn active" data-category="">All Posts</button>
                    <button class="filter-btn" data-category="Python Development">Python Development</button>
                    <button class="filter-btn" data-category="Raspberry Pi">Raspberry Pi</button>
                    <button class="filter-btn" data-category="Best Practices">Best Practices</button>
                </div>
                
                <div class="blog-posts" id="blogPosts">
                    {% for post in posts %}
                    <article class="blog-post-card" data-category="{{ post.category }}">
                        <div class="post-image">
                            <img src="{{ post.image }}" alt="{{ post.title }}" onerror="this.src='/static/images/placeholder.jpg'">
                            <span class="post-category">{{ post.category }}</span>
                        </div>
                        <div class="post-content">
                            <div class="post-meta">
                                <span class="post-author">
                                    <i class="fas fa-user"></i> {{ post.author }}
                                </span>
                                <span class="post-date">
                                    <i class="far fa-calendar"></i> {{ post.date|format_date }}
                                </span>
                                <span class="post-time">
                                    <i class="far fa-clock"></i> {{ post.read_time }}
                                </span>
                            </div>
                            
                            <h2><a href="{{ url_for('blog_post', post_id=post.id) }}">{{ post.title }}</a></h2>
                            <p class="post-excerpt">{{ post.excerpt }}</p>
                            
                            <div class="post-tags">
                                {% for tag in post.tags %}
                                <span class="tag">{{ tag }}</span>
                                {% endfor %}
                            </div>
                            
                            <a href="{{ url_for('blog_post', post_id=post.id) }}" class="read-more-btn">
                                Read Full Article <i class="fas fa-arrow-right"></i>
                            </a>
                        </div>
                    </article>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Sidebar -->
            <aside class="blog-sidebar">
                <div class="sidebar-widget">
                    <h3>About the Author</h3>
                    <div class="author-info">
                        <div class="author-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <p>Experienced Python developer sharing knowledge about software engineering, IoT, and best practices.</p>
                        <a href="{{ url_for('about') }}" class="btn btn-small">Learn More</a>
                    </div>
                </div>
                
                <div class="sidebar-widget">
                    <h3>Popular Topics</h3>
                    <div class="topic-tags">
                        <a href="#" class="topic-tag">Python</a>
                        <a href="#" class="topic-tag">Django</a>
                        <a href="#" class="topic-tag">Flask</a>
                        <a href="#" class="topic-tag">Raspberry Pi</a>
                        <a href="#" class="topic-tag">IoT</a>
                        <a href="#" class="topic-tag">Machine Learning</a>
                        <a href="#" class="topic-tag">Best Practices</a>
                        <a href="#" class="topic-tag">Testing</a>
                        <a href="#" class="topic-tag">DevOps</a>
                    </div>
                </div>
                
                <div class="sidebar-widget">
                    <h3>Newsletter</h3>
                    <p>Subscribe to get the latest posts delivered to your inbox.</p>
                    <form class="newsletter-form">
                        <input type="email" placeholder="Your email address" required>
                        <button type="submit" class="btn btn-primary">Subscribe</button>
                    </form>
                </div>
                
                <div class="sidebar-widget">
                    <h3>Recent Posts</h3>
                    <ul class="recent-posts-list">
                        {% for post in posts[:3] %}
                        <li>
                            <a href="{{ url_for('blog_post', post_id=post.id) }}">
                                <span class="recent-post-title">{{ post.title }}</span>
                                <span class="recent-post-date">{{ post.date|format_date }}</span>
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </aside>
        </div>
    </div>
</section>

<!-- Featured Tutorial Section -->
<section class="featured-tutorial">
    <div class="container">
        <h2 class="section-title">Featured Tutorial</h2>
        <div class="tutorial-content">
            <h3>Building a RESTful API with Flask and SQLAlchemy</h3>
            <p class="tutorial-intro">Learn how to build a production-ready REST API with authentication, validation, and comprehensive error handling.</p>
            
            <div class="tutorial-steps">
                <div class="tutorial-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Project Setup</h4>
                        <pre><code class="language-bash"># Create virtual environment
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install flask flask-sqlalchemy flask-jwt-extended flask-marshmallow

# Create project structure
mkdir -p app/{models,routes,schemas}
touch app/__init__.py app/config.py
</code></pre>
                    </div>
                </div>
                
                <div class="tutorial-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Application Factory Pattern</h4>
                        <pre><code class="language-python"># app/__init__.py
from flask import Flask
from flask_sqlalchemy import SQLAlchemy
from flask_jwt_extended import JWTManager
from flask_marshmallow import Marshmallow

db = SQLAlchemy()
jwt = JWTManager()
ma = Marshmallow()

def create_app(config_name='development'):
    """Application factory pattern"""
    app = Flask(__name__)
    app.config.from_object(f'app.config.{config_name.capitalize()}Config')
    
    # Initialize extensions
    db.init_app(app)
    jwt.init_app(app)
    ma.init_app(app)
    
    # Register blueprints
    from app.routes import auth, users, posts
    app.register_blueprint(auth.bp)
    app.register_blueprint(users.bp)
    app.register_blueprint(posts.bp)
    
    # Error handlers
    @app.errorhandler(404)
    def not_found(error):
        return {'error': 'Resource not found'}, 404
    
    @app.errorhandler(500)
    def internal_error(error):
        db.session.rollback()
        return {'error': 'Internal server error'}, 500
    
    return app
</code></pre>
                    </div>
                </div>
                
                <div class="tutorial-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Database Models</h4>
                        <pre><code class="language-python"># app/models/user.py
from app import db
from werkzeug.security import generate_password_hash, check_password_hash
from datetime import datetime

class User(db.Model):
    """User model with authentication"""
    __tablename__ = 'users'
    
    id = db.Column(db.Integer, primary_key=True)
    username = db.Column(db.String(80), unique=True, nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)
    password_hash = db.Column(db.String(255), nullable=False)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    updated_at = db.Column(db.DateTime, onupdate=datetime.utcnow)
    
    # Relationships
    posts = db.relationship('Post', backref='author', lazy='dynamic')
    
    def set_password(self, password):
        """Hash and set password"""
        self.password_hash = generate_password_hash(password)
    
    def check_password(self, password):
        """Verify password"""
        return check_password_hash(self.password_hash, password)
    
    def __repr__(self):
        return f'<User {self.username}>'
</code></pre>
                    </div>
                </div>
                
                <div class="tutorial-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>API Routes with JWT Authentication</h4>
                        <pre><code class="language-python"># app/routes/users.py
from flask import Blueprint, request, jsonify
from flask_jwt_extended import jwt_required, get_jwt_identity
from app import db
from app.models.user import User
from app.schemas.user import UserSchema

bp = Blueprint('users', __name__, url_prefix='/api/users')
user_schema = UserSchema()
users_schema = UserSchema(many=True)

@bp.route('/', methods=['GET'])
@jwt_required()
def get_users():
    """Get all users (protected route)"""
    users = User.query.all()
    return jsonify(users_schema.dump(users)), 200

@bp.route('/<int:user_id>', methods=['GET'])
@jwt_required()
def get_user(user_id):
    """Get specific user"""
    user = User.query.get_or_404(user_id)
    return jsonify(user_schema.dump(user)), 200

@bp.route('/<int:user_id>', methods=['PUT'])
@jwt_required()
def update_user(user_id):
    """Update user (only own profile)"""
    current_user_id = get_jwt_identity()
    
    if current_user_id != user_id:
        return {'error': 'Unauthorized'}, 403
    
    user = User.query.get_or_404(user_id)
    data = request.get_json()
    
    # Validate and update
    errors = user_schema.validate(data, partial=True)
    if errors:
        return {'errors': errors}, 400
    
    if 'username' in data:
        user.username = data['username']
    if 'email' in data:
        user.email = data['email']
    
    db.session.commit()
    return jsonify(user_schema.dump(user)), 200

@bp.route('/<int:user_id>', methods=['DELETE'])
@jwt_required()
def delete_user(user_id):
    """Delete user"""
    current_user_id = get_jwt_identity()
    
    if current_user_id != user_id:
        return {'error': 'Unauthorized'}, 403
    
    user = User.query.get_or_404(user_id)
    db.session.delete(user)
    db.session.commit()
    
    return {'message': 'User deleted successfully'}, 200
</code></pre>
                    </div>
                </div>
            </div>
            
            <div class="tutorial-footer">
                <p>This is just a preview. Read the full tutorial for complete implementation details, testing strategies, and deployment guides.</p>
                <a href="#" class="btn btn-primary">Read Full Tutorial</a>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
// Blog filtering
document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('.filter-btn');
    const blogPosts = document.querySelectorAll('.blog-post-card');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            const category = this.dataset.category;
            
            // Update active button
            filterButtons.forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            
            // Filter posts
            blogPosts.forEach(post => {
                if (!category || post.dataset.category === category) {
                    post.style.display = 'block';
                } else {
                    post.style.display = 'none';
                }
            });
        });
    });
    
    // Newsletter form
    const newsletterForm = document.querySelector('.newsletter-form');
    if (newsletterForm) {
        newsletterForm.addEventListener('submit', function(e) {
            e.preventDefault();
            alert('Thank you for subscribing! (This is a demo)');
            this.reset();
        });
    }
});
</script>
{% endblock %}
